name: AzureKeyVault_InputSecrets

on:
  push:
    branches:
      - master

env:
  DEFAULT_SECRET_NAME: 'test-secret'
  DEFAULT_VALUE: 'test-secret-value'

jobs:
  create_secrets:
    runs-on: self-hosted

    steps:
      - name: Set up Azure CLI
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Set Azure subscription
        run: az account set --subscription ${{ secrets.SUBSCRIPTION }}

      - name: Input secret name and value
        id: input
        run: |
          echo "Enter the secret name (default: $DEFAULT_SECRET_NAME):"
          read secret_name
          echo "Enter the value (default: $DEFAULT_VALUE):"
          read value

          # Use default values if input is empty
          secret_name=${secret_name:-$DEFAULT_SECRET_NAME}
          value=${value:-$DEFAULT_VALUE}

          echo "::set-env name=SECRET_NAME::$secret_name"
          echo "::set-env name=VALUE::$value"
        
      - name: Create secrets in Azure Key Vault
        run: |
          az keyvault secret set --vault-name kunlawt24keyvault --name ${{ env.SECRET_NAME }} --value ${{ env.VALUE }}
          az keyvault secret set --vault-name kunlawt24keyvault02 --name ${{ env.SECRET_NAME }} --value ${{ env.VALUE }}
